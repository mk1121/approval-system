# Real-time Approval System

A Next.js based approval management system integrated with Oracle Database. This application provides real-time dashboard updates for pending requests, email notifications with simple approval actions, and a RESTful API for external system integration.

## Features

- **Real-time Dashboard**: Live polling (every 5s) displays new requests instantly without refresh.
- **Oracle Database Integration**: Robust persistence using `node-oracledb`.
- **Email Notifications**: customizable email alerts sent via SMTP (Nodemailer).
- **One-Click Email Actions**: Approve or Reject requests directly from the email inbox.
- **Secure Login**: Simple authentication system (extensible).
- **REST API**: Full programmatic access to submit requests and check status.

## Prerequisites

- **Node.js**: v18 or higher
- **Oracle Database**: Oracle 19c or 21c (XE or Enterprise)
- **SMTP Server**: For email notifications (e.g., Gmail, Brevo, SendGrid)

## Installation

1.  **Clone the repository:**
    ```bash
    git clone <repository_url>
    cd approval
    ```

2.  **Install dependencies:**
    ```bash
    npm install
    # or
    bun install
    ```

## Configuration

1.  **Database Setup:**
    Execute the schema script in your Oracle Database to create the necessary table.
    File: `database/schema.sql`
    ```sql
    CREATE TABLE APPROVAL_REQUESTS (
        ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
        REQUEST_DATA VARCHAR2(4000),
        APP_FLAG CHAR(1) CHECK (APP_FLAG IN ('y', 'n')),
        EMAIL_FLAG CHAR(1) CHECK (EMAIL_FLAG IN ('y', 'n')),
        STATUS CHAR(1) DEFAULT 'P' CHECK (STATUS IN ('P', 'A', 'R')),
        USER_EMAIL VARCHAR2(255),
        CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP
    );
    CREATE INDEX IDX_APPROVAL_STATUS ON APPROVAL_REQUESTS(STATUS);
    ```

2.  **Environment Variables:**
    Create a `.env.local` file in the root directory:
    ```env
    # Database Configuration
    ORACLE_USER=your_db_user
    ORACLE_PASSWORD=your_db_password
    ORACLE_CONNECT_STRING=localhost/XEPDB1

    # Email Service Configuration (SMTP)
    EMAIL_HOST=smtp.example.com
    EMAIL_PORT=587
    EMAIL_USER=your_smtp_user
    EMAIL_PASS=your_smtp_password
    EMAIL_FROM=no-reply@yourdomain.com

    # Application URL (Used for generating email links)
    NEXT_PUBLIC_APP_URL=http://localhost:3000
    ```

## Running the Application

**Development Mode:**
```bash
npm run dev
```
Access the app at `http://localhost:3000`.

**Production Build:**
```bash
npm run build
npm start
```

## API Documentation

### 1. Create Approval Request
Submit a new request from an external system.

*   **Endpoint**: `POST /api/requests`
*   **Content-Type**: `application/json`
*   **Body**:
    ```json
    {
      "request_data": "Approve Purchase Order #9988",
      "app_flag": "y",       // 'y' to show in dashboard, 'n' to hide
      "email_flag": "y",     // 'y' to send email, 'n' to skip
      "user_email": "approver@example.com"
    }
    ```
*   **Response (201 Created)**:
    ```json
    {
      "ID": 101,
      "REQUEST_DATA": "Approve Purchase Order #9988",
      "STATUS": "P",
      "CREATED_AT": "2026-01-21T10:00:00.000Z",
      ...
    }
    ```

### 2. Get Pending Requests
Fetch all requests currently waiting for approval (Status 'P').

*   **Endpoint**: `GET /api/requests`
*   **Response**: Array of request objects.

### 3. Get Request Status
Check the status of a specific request by ID.

*   **Endpoint**: `GET /api/requests/:id`
*   **Example**: `GET /api/requests/101`
*   **Response**:
    ```json
    {
      "ID": 101,
      "STATUS": "A",  // 'A' = Approved, 'R' = Rejected, 'P' = Pending
      ...
    }
    ```

### 4. Process Approval
Programmatically approve or reject a request.

*   **Endpoint**: `POST /api/approve`
*   **Body**:
    ```json
    {
      "id": 101,
      "action": "approve" // or "reject"
    }
    ```

## Project Structure

- `app/`: Next.js App Router pages and API routes.
  - `api/`: Backend API endpoints.
  - `action/`: Email link landing page.
  - `login/`: Authentication page.
- `lib/`: Shared utilities.
  - `db.ts`: Oracle DB connection pool management.
  - `email.ts`: Nodemailer configuration and sending logic.
- `database/`: SQL scripts.

## Technologies

- **Frontend**: Next.js 15, Tailwind CSS, React
- **Backend**: Next.js API Routes (Node.js)
- **Database**: Oracle Database
- **Email**: Nodemailer
